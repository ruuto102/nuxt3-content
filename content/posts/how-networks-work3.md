---
title: "【読書記録】ネットワークはなぜつながるのか第二版③\nTCP/IPとDNSリゾルバ"
date: 2024-09-30
draft: false
tags: ["hello", "world"]
thumbnail: '/img/HowNetworksWork.jpg'
slug: "how-networks-work3"
---
本日も昨日に引き続き表題の件について、アウトプットしていきます。  

ブラウザはHTTPメッセージを作る機能は持っているが、送る機能はないのでOSに依頼します。  
その時、OSは依頼されたメッセージの中のサーバーのドメイン名からIPアドレスを調べなければいけません。  

## TCP/IPとは
TCP/IPの考え方は、小さな**サブネット**をルーターで繋いで全体のネットワークが出来上がることです。  
**サブネット**とは、ハブに何台かのPCを繋いだものというイメージです。

![TCP/IPの図](/img/tcp-ip.svg)

図のようにリクエストメッセージ内のIPアドレスが宛先住所となって、ルーターを経由してアクセス先にデータを届けます。  
※視覚的に理解できる力作の図ができました。笑

また、**IPアドレス**は、⚪︎⚪︎丁目△△番地というようなネットワーク上で割り当てられた住所とも言えます。  

## IPアドレスとは
32ビットのデジタルデータで、8ビット（1バイト）ずつドットで区切って10進数で表記します。  
※10進法では、10ずつで位を1つ上げ、十の位の数で「10が何個あるのか」を表現します。  

**13.228.199.255**　←　このブログサイトのIPアドレスです。  
最後が255場合は、16ビット符号無し整数で表すと00000000 11111111となります。  
ということは、ホスト番号が全て１ということなので、これはそのサブネット全体に対する**ブロードキャスト**を表します。  
※ブロードキャストとは、サブネット上にある機器全員にパケットを送るもの  

**10.11.12.0**　← ホスト番号のビットが全て０の場合はここのコンピュータではなく、**サブネット全体**を表す。  

## ネットマスクとは
IPアドレスは10進数で表記されていますが、どこがネットワーク番号で、どこがホスト番号なのかわからないのですが、それがわかるようにする付加情報です。  
ネットマスクも３２ビットのデジタルデータで、ネットワーク番号部分は「１」、ホスト部分は「０」と表します。  

このあたりの話は１０進数の知識も必要なので理解が難しいですが、何となくIPアドレスの構造が見えてきました。  

## DNSとは
では、わざわざドメイン名とIPアドレスを分ける理由とは何でしょう。   
まずIPアドレスは数字の羅列なので人はそれを覚えるのが難しいです。  
例に身の回りの電話番号を全て暗記しろと言われたら、大変な思いをするでしょう。  
では、ドメイン名のみで通信できればいいのでは？と考えるかもしれませんが、IPアドレスなら32ビット（＝4バイト）分の数値を扱うだけですが、ドメイン名はその何倍ものデータ量です。    
その分、ネットワーク通信自体が遅くなったりと、弊害があるため、現在では、人はドメイン名を使い、ルーターはIPアドレスを使うといる方法に落ち着いています。   

そして、ドメイン名とIPアドレスを紐付けする仕組みが**DNS**です。  
※Domain Name System

ドメイン名を最寄のDNSサーバーに問い合わせると、紐付いたIPアドレスをおしえてくれます。  

では、DNSサーバーにどのように問い合わせを送っているのでしょうか。  

## DNSリゾルバ　
**DNSクライアント**にあたるものが、**DNSリゾルバ（リゾルバとも言う）**です。    

DNSの仕組みを使ってIPアドレスを調べること**ネーム・リゾリューション**といいます。  
そのリゾリューションを実行することから、リゾルバ（resolver）と名付けられた。  

## Socketライブラリ
OSに組み込まれているネットワーク機能をアプリケーションから呼び出すための部品集が**Socketライブラリ**で、**リゾルバ**はそのライブラリのプログラム部品の一つです。

## リゾルバの使用法
ブラウザのアプリケーションを作る時など、リゾルバのプログラム名（gethostbyname）と、Webサーバー名（https://yoshi7-blog.netlify.app/）と書けば、リゾルバを呼び出すことができます。  
そうすると、呼び出されたリゾルバがDNSサーバーに問い合わせて、返答からIPアドレスを指定されたメモリー領域に書き込みをしてくれます。  

<section class="bg-gray-100 p-3 mb-4 text-xs md:w-1/2">

＜アプリケーションプログラム名＞　(＜パラメータ＞)  
・・・  
＜メモリー領域＞　＝　gethostbyname（"https://yoshi7-blog.netlify.app/"）  
・・・  　　　　　　　↑リゾルバのプログラム名 ↑問い合わせるサーバーのドメイン名  
・・・  
＜HTTPメッセージを送信する＞  
</section>

上記のようにブラウザがWebサーバーにリクエストメッセージを送る時に　メモリー領域からIPアドレスを取り出して、HTTPSリクエストメッセージと一緒にOS渡して送信依頼をします。  

上のようにアプリケーションプログラムの中で、リゾルバが呼び出されたら、、、  
①アプリケーションの動作が一度止まる  
②OS内部のSocketライブラリ内のリゾルバが動き始める  
③リゾルバが問い合わせメッセージを作る  
④そのメッセージをOS内部のプロトコル・スタックによって送受信される  
⑤プロトコル・スタックを経由してリゾルバに返答が来る  
⑥リゾルバが中身を解読して、IPアドレスを取り出し、アプリケーションに渡す  
これでDNSサーバーから無事IPアドレスをゲットして、アプリケーションが次の動作します。  

※プロトコル・スタック：OS内部に組み込まれたネットワーク制御用のソフトウェア。「TCP/IPソフト」などとも呼びます。  


ちなみに、DNSサーバーにメッセージを送信するときもDNSサーバーのIPアドレスが必要です  
それはTCP/IPの設定に予め端末にされているため、あらためて調べることはしなくて大丈夫になっています。  
リゾルバは、このもともとパソコン設定されているDNSサーバーに問い合わせを送るということです。  

だいぶ長くなったので、一旦ここまでで区切ることにします。  
内部の動きが理解することでプログラミングももっとスマートにできるはずです。（自分に言い聞かせてます。）    

では明日は、DNSサーバーについてまとめていきます。  

最後までご覧いただきありがとうございます。    

執筆時間：4.5時間
